package ntnu.idatt2105.semesterProject.eCommerceMarketplace.controller;

import ntnu.idatt2105.semesterProject.eCommerceMarketplace.accessingdatamysql.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

import java.io.PrintWriter;
import java.io.StringWriter;
import java.util.List;
import java.util.Map;
import java.util.Optional;

@Controller
public class MainController {
    // This means to get the bean called userRepository, which is auto-generated by Spring
    @Autowired
    private UserRepository userRepository;
    private ItemRepository itemRepository;

    @PostMapping("/register") // Map ONLY POST Requests
    public @ResponseBody String addNewUser(@RequestParam String username, @RequestParam String password) {

        User user = new User();
        user.setUsername(username);
        user.setPassword(password);
        userRepository.save(user);
        return "Registered";
    }

    // Returns all users
    @CrossOrigin
    @GetMapping("/user/{id}")
    public @ResponseBody Optional<User> getUser(@PathVariable int id) {
        return userRepository.findById(id);
    }

    // Returns user with given id
    // If no user exist with given id, it returns null
    @CrossOrigin
    @GetMapping("/user")
    public @ResponseBody Iterable<User> getAllUsers() {
        return userRepository.findAll();
    }

    @CrossOrigin
    @PostMapping("/login")
    public @ResponseBody boolean isUser(@RequestBody Map<String, Object> payload) {
        String username = payload.get("username").toString();
        String password = payload.get("password").toString();

        for (User user : userRepository.findAll()) {
            if (user.getUsername().equals(username) && user.getPassword().equals(password)) {
                return true;
            }
        }
        return false;
    }


    @CrossOrigin
    @PostMapping("/createitem")
    public @ResponseBody boolean createItem(@RequestBody Item item) {

        try {
            itemRepository.save(item);
            return true;
        } catch (Exception e) {
            return false;
        }
    }
}
